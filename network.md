# 五层协议
> 物理层   
> 数据链路层（MAC地址）    
> 网络层（ip地址，主机对主机）   
> 传输层（端口号，应用对应用）    
> 应用层（数据格式）。

## 数据链路层
> 以太网协议     
> MAC地址(4848个二进制位，通常用12个十六进制数表示)
> 帧=Head(18字节)+Data(最长1500字节)

## 网络层（ip地址，主机对主机）
### IP协议
比较两个IP与子网掩码AND的结果可知两主机是否处于同一个子网

### ARP协议
> 处于**网络层**，用于从IP地址得到MAC地址。   
> ARP缓存表:每台电脑都有自己的ARP缓存表(同一子网下的主机)，ARP广播通过交换机实现。

### IP数据包
[Head(20-60)+Data()]<65535

## 传输层（端口号，应用对应用）
### UDP协议

### TCP协议
## 重要的头部信息
* Seq     
> 该数据段序号，由发送方维护     
> 接收方通过Seq对接收到的数据包进行排序
* Len   
> 数据段长度，不包括头    
* ACK
> 确认号，确认目前成功接收到对方已收到的字节。        
> 接收方接收到多个数据包后，根据Seq排序后，相邻数据包X[n+1].Seq！=X[n].Seq+X[n].Len，接收方发回数据包ACK=X[n].Seq+X[n].Len请求重传        
* SYN     
> 表示正在建立连接，双发都会发送SYN      
* FIN     
> 表示正在终止连接，双发都会发送FIN      
* RST     
> 重置一个混乱的连接，或者拒绝一个无效的请求

## 三次握手
### 握手过程
> ![如图](https://github.com/0ragdoll0/Front-end-Q-A/blob/master/pic/syn.jpg)             
> 客户端：[SYN=1,Seq=X]我想和你建立一个连接，我的初始序列号seq是X，如果你答应，请返回ACK=X+1 。           
> 服务器：[SYN=1,ACK=X+1,Seq=Y]ACK=X+1，我们可以建立连接。我的初始序列号是Y，如果你答应连接，请返回ACK=Y+1                  
> 客户端：[Seq=X+1，ACK=Y+1]               
> 此时完成连接

### 为什么需要三次握手
> 如果有一次连接请求经过长时间才到服务器端，而需要传输的数据已在之前成功连接后传输完毕并关闭了连接，在只存在两次握手的情况下又会建立一次无效的连接。   
> 在三次握手的机制下，客户端在接受到服务器的回应时，可返回拒绝连接的请求


## 四次挥手
> ![如图](https://github.com/0ragdoll0/Front-end-Q-A/blob/master/pic/FIN.jpg)
### 挥手过程
> 客户端：[FIN，ACK]我想要断开连接，你如果有未传输完的数据可继续传输，但先返回ACK       
> 服务器：[ACK]你的请求我收到了。（但我还没准备好，你等我消息->客户端进入FIN-WAIT阶段）       
> 服务器：[FIN,ACK]可以关闭连接了        
> 客户端：[ACK]可以关闭连接了,进入TIME_WAIT,如果服务器端没有关闭则重新发送ACK


## 应用层（数据格式）
规定应用程序的数据格式
### DNS协议
* 基本功能      
> 将域名解析为服务器对应的ip地址

* 工作方式      
> 递归模式：完全依赖本地DNS服务器，本地DNS服务器向其他DNS服务器查找ip。常用。             
> 迭代模式：客户端自身询问各个DNS服务器查询IP

* 有用特性      
> 循环工作模式。在DNS中将一个域名映射到多个不同的服务器ip，可实现负载均衡。         

* 传输层协议   
> 使用TCP：区域传输时使用TCP。区域传输：辅域名服务器每隔一段时间向主域名服务器读取DNS数据，使用TCP可传输512字节以上的数据且传输可靠。     
> 使用UDP：客户端查询域名时，需要传输的数据小，使用UDP可不需要三次握手，减小负载，提高速度。

# 访问网页
## 1.检查 HSTS 列表
浏览器检查自带的“预加载 HSTS（HTTP严格传输安全）”列表，如果网站在这个列表里，浏览器会使用 HTTPS 而不是 HTTP 协议。

## 2.DNS查询
1. 是否在浏览器缓存中
2. 是否在本地Hosts中
3. 查询DNS服务器（递归/迭代）

## 3.子网掩码
通过ip和子网掩码AND运算判断两主机是否处于同一子网，如不是则通过网关转发

## 4.缓存判断
强缓存/协商缓存/直接请求资源

## 5.数据封装
1. 应用层协议
HTTP协议，内容包括请求方法（GET、POST等）和其他内容

2. TCP协议
包头设置端口号

3. IP协议
设置收发方IP地址

4. 以太网协议
设置收发方MAC地址（不同子网时，收方MAC会在转发过程中一直变化）
